/*! numeric-mastermind-solver-js 2016-03-06. Copyright Claudio Rodriguez <cjrodr@yahoo.com> */
!function(){"use strict";function a(a){var c={places:4,numbers:4};this.options=b({},c,a),this.reset()}var b=function(a){for(var b=Array.prototype.slice.call(arguments,1),c=0;c<b.length;++c){var d=b[c];for(var e in d)d.hasOwnProperty(e)&&(a[e]=d[e])}return a};a.prototype.reset=function(){this.currentTry=0,this.combinations=[],this.maxCombs=Math.pow(this.options.numbers,this.options.places),this.state="initial",this.possible=0;var a,b=[];for(a=0;a<this.options.numbers;a++)b[a]=a+1;this.numberNames=b},a.prototype.getGuess=function(){if("solved"===this.state)throw new Error("Mastermind already solved");if("initial"!==this.state&&"fedpins"!==this.state)throw new Error("Incorrect state, cannot guess at this time");var a,b,c,d,e,f,g=this.options.places,h=this.options.numbers,i=this.maxCombs;for(this.state="guessing",a=[],b=0,f=0;i>f;f++)void 0===this.combinations[f]&&(b++,a[b]=f);for(c=a[Math.floor(Math.random()*b)+1],a=null,d=[],f=0;g>f;f++)d[f]=Math.floor(c/Math.pow(h,f))%h;for(this.curComb=d,this.currentTry++,e="",f=g-1;f>=0;f--)e+=this.numberNames[d[f]];return parseInt(e,10)},a.prototype.feedPins=function(a,b){if("guessing"!==this.state)throw new Error("Must be in guessing state to feed guess results");var c,d,e,f,g,h,i,j,k,l=this.options.places,m=this.options.numbers,n=this.maxCombs;if(a===this.options.places)return void(this.state="solved");if(a+b>this.options.numbers)throw new Error("Invalid number of pins");for(this.possible=0,c=0,d=0;n>d;d++){if(Math.floor(10*d/(n-1))>=c&&c++,void 0===this.combinations[d]){for(e=[],k=0;l>k;k++)e[k]=Math.floor(d/Math.pow(m,k))%m;for(f=0,g=0,h=[],i=0;l>i;i++)this.curComb[i]===e[i]&&(f++,e[i]=-1,h[i]=1);for(i=0;l>i;i++)if(void 0===h[i])for(j=0;l>j;j++)if(this.curComb[i]===e[j]){g++,e[j]=-1;break}(b!==g||a!==f)&&(this.combinations[d]=0)}void 0===this.combinations[d]&&this.possible++}return this.state="fedpins",0===this.possible&&(this.state="failed"),this.status()},a.prototype.status=function(){var a="initial"===this.state||this.currentTry<=1?this.maxCombs:this.possible,b=Math.floor(1e4/a+.5)/1e4,c={state:this.state};return"solved"!==this.state&&"failed"!==this.state&&(c.possibilities=a,c.successProbability=b),c},a.matchPins=function(a,b){if(a=parseInt(a,10).toString(),b=parseInt(b,10).toString(),b.length!==a.length)throw new Error("Mismatched solution and guess lengths");var c,d,e=0,f=0,g=[],h=[];for(c=0;c<b.length;c++)a[c]===b[c]&&(e++,g[c]=!0);for(c=0;c<b.length;c++)if(!g[c])for(d=0;d<a.length;d++)if(!g[d]&&!h[d]&&b[c]===a[d]){h[d]=!0,f++;break}return{green:e,blue:f}},"undefined"!=typeof define&&null!==define&&define.amd?define(function(){return a}):"undefined"!=typeof module&&null!==module?module.exports=a:"undefined"!=typeof self&&"function"==typeof self.postMessage&&"function"==typeof self.importScripts?self.Mastermind=a:"undefined"!=typeof window&&null!==window&&(window.Mastermind=a)}();