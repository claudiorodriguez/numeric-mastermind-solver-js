<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>Numeric Mastermind Solver JS</title>
</head>
<body>
  <script type="text/javascript">
    var places = parseInt(prompt('How many places? (1-n)'));
    var numbers = parseInt(prompt('What is the max number? (starts from 1, 2-9)'));
    var currentTry = 0;
    var combinations = [], maxCombs = Math.pow(numbers,places);
    var numberNames = [], i;
    for (i=0; i < numbers; i++) {
      numberNames[i] = i + 1;
    }

    alert('There are ' + maxCombs + ' possible combinations. \n' +
          'Success probability: ' + Math.floor(10000/maxCombs+0.5)/100 + '%');

    var temp, tot, curCombNumber, curComb, output, possible = 0, greenPins, bluePins, last;
    var examinedCombNumber, examinedComb, examinedGreenPins, examinedBluePins, used, a, b;

    while (true) {
      temp = [];
      tot = 0;
      for (i=0; i < maxCombs; i++) {
        if (combinations[i] === undefined) {
          tot++;
          temp[tot] = i;
        }
      }

      curCombNumber=temp[Math.floor(Math.random() * tot) + 1];
      temp=null;
      curComb = [];
      for (i=0; i < places; i++) {
        curComb[i] = Math.floor(curCombNumber / Math.pow(numbers,i)) % numbers
      }
      currentTry++;
      output = 'Try #' + currentTry + ': ';
      for (i=places-1; i >= 0; i--) {
        output += numberNames[curComb[i]];
      }

      alert(output);

      if (possible===1) {
        alert('Solved.');
        break;
      }

      greenPins = parseInt(prompt('How many correct digits in the correct place?'));
      if (greenPins===places) {
        alert('Solved.');
        break;
      }
      bluePins = parseInt(prompt('How many correct digits in the wrong place?'));
      possible=0;
      last=0;

      for (examinedCombNumber=0; examinedCombNumber < maxCombs; examinedCombNumber++) {
        if (Math.floor(10*examinedCombNumber/(maxCombs-1))>=last) {
          last++;
        }
        if (combinations[examinedCombNumber] === undefined) {
          examinedComb=[];
          for (i=0; i < places; i++) {
            examinedComb[i]=Math.floor(examinedCombNumber/Math.pow(numbers,i)) % numbers;
          }
          examinedGreenPins=0;
          examinedBluePins=0;
          used=[];
          for (a=0; a < places; a++) {
            if (curComb[a] === examinedComb[a]) {
              examinedGreenPins++;
              examinedComb[a] = -1;
              used[a] = 1;
            }
          }
          for (a=0; a < places; a++) {
            if (used[a] === undefined) {
              for (b=0; b < places; b++) {
                if (curComb[a] === examinedComb[b]) {
                  examinedBluePins++;
                  examinedComb[b]= -1;
                  break;
                }
              }
            }
          }
          if (bluePins !== examinedBluePins || greenPins !== examinedGreenPins) {
            combinations[examinedCombNumber] = 0;
          }
        }
        if (combinations[examinedCombNumber] === undefined) {
          possible++;
        }
      }

      alert('There are ' + possible + ' possible combinations.');
      if (possible>1) {
        alert('Success probability: ' + Math.floor(10000/possible+0.5)/100 + '%');
      }
      if (possible===0) {
        alert('No solutions found.');
        break;
      }
    }
  </script>
</body>
</html>